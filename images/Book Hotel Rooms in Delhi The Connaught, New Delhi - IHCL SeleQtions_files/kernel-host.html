<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><script type="text/javascript">//<![CDATA[
(()=>{var Li=Object.create;var Ce=Object.defineProperty,Hi=Object.defineProperties,kr=Object.getOwnPropertyDescriptor,Ni=Object.getOwnPropertyDescriptors,Fi=Object.getOwnPropertyNames,ze=Object.getOwnPropertySymbols,Wi=Object.getPrototypeOf,At=Object.prototype.hasOwnProperty,Ir=Object.prototype.propertyIsEnumerable;var Rr=(r,e,t)=>e in r?Ce(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,C=(r,e)=>{for(var t in e||(e={}))At.call(e,t)&&Rr(r,t,e[t]);if(ze)for(var t of ze(e))Ir.call(e,t)&&Rr(r,t,e[t]);return r},ke=(r,e)=>Hi(r,Ni(e)),Gi=r=>Ce(r,"__esModule",{value:!0});var Mr=(r,e)=>{var t={};for(var n in r)At.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&ze)for(var n of ze(r))e.indexOf(n)<0&&Ir.call(r,n)&&(t[n]=r[n]);return t};var g=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Ki=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Fi(e))!At.call(r,n)&&n!=="default"&&Ce(r,n,{get:()=>e[n],enumerable:!(t=kr(e,n))||t.enumerable});return r},q=r=>Ki(Gi(Ce(r!=null?Li(Wi(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r),Ie=(r,e,t,n)=>{for(var i=n>1?void 0:n?kr(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&Ce(e,t,i),i};var y=(r,e,t)=>new Promise((n,i)=>{var o=c=>{try{s(t.next(c))}catch(u){i(u)}},a=c=>{try{s(t.throw(c))}catch(u){i(u)}},s=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,a);s((t=t.apply(r,e)).next())});var v=g((Ba,Be)=>{var jr,qr,Dr,Er,Lr,Hr,Nr,Fr,Wr,Ve,Ct,Gr,Kr,Ur,X,zr,Vr,$r,Br,Jr,Zr,Yr,Qr,Xr,$e;(function(r){var e=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&undefined?define("tslib",["exports"],function(n){r(t(e,t(n)))}):typeof Be=="object"&&typeof Be.exports=="object"?r(t(e,t(Be.exports))):r(t(e));function t(n,i){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(o,a){return n[o]=i?i(o,a):a}}})(function(r){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])};jr=function(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");e(n,i);function o(){this.constructor=n}n.prototype=i===null?Object.create(i):(o.prototype=i.prototype,new o)},qr=Object.assign||function(n){for(var i,o=1,a=arguments.length;o<a;o++){i=arguments[o];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n},Dr=function(n,i){var o={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&i.indexOf(a)<0&&(o[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(n);s<a.length;s++)i.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(n,a[s])&&(o[a[s]]=n[a[s]]);return o},Er=function(n,i,o,a){var s=arguments.length,c=s<3?i:a===null?a=Object.getOwnPropertyDescriptor(i,o):a,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,i,o,a);else for(var m=n.length-1;m>=0;m--)(u=n[m])&&(c=(s<3?u(c):s>3?u(i,o,c):u(i,o))||c);return s>3&&c&&Object.defineProperty(i,o,c),c},Lr=function(n,i){return function(o,a){i(o,a,n)}},Hr=function(n,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,i)},Nr=function(n,i,o,a){function s(c){return c instanceof o?c:new o(function(u){u(c)})}return new(o||(o=Promise))(function(c,u){function m(O){try{f(a.next(O))}catch(Y){u(Y)}}function S(O){try{f(a.throw(O))}catch(Y){u(Y)}}function f(O){O.done?c(O.value):s(O.value).then(m,S)}f((a=a.apply(n,i||[])).next())})},Fr=function(n,i){var o={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},a,s,c,u;return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(f){return function(O){return S([f,O])}}function S(f){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,s&&(c=f[0]&2?s.return:f[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,f[1])).done)return c;switch(s=0,c&&(f=[f[0]&2,c.value]),f[0]){case 0:case 1:c=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,s=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(c=o.trys,!(c=c.length>0&&c[c.length-1])&&(f[0]===6||f[0]===2)){o=0;continue}if(f[0]===3&&(!c||f[1]>c[0]&&f[1]<c[3])){o.label=f[1];break}if(f[0]===6&&o.label<c[1]){o.label=c[1],c=f;break}if(c&&o.label<c[2]){o.label=c[2],o.ops.push(f);break}c[2]&&o.ops.pop(),o.trys.pop();continue}f=i.call(n,o)}catch(O){f=[6,O],s=0}finally{a=c=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},Wr=function(n,i){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&$e(i,n,o)},$e=Object.create?function(n,i,o,a){a===void 0&&(a=o);var s=Object.getOwnPropertyDescriptor(i,o);(!s||("get"in s?!i.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return i[o]}}),Object.defineProperty(n,a,s)}:function(n,i,o,a){a===void 0&&(a=o),n[a]=i[o]},Ve=function(n){var i=typeof Symbol=="function"&&Symbol.iterator,o=i&&n[i],a=0;if(o)return o.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&a>=n.length&&(n=void 0),{value:n&&n[a++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},Ct=function(n,i){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var a=o.call(n),s,c=[],u;try{for(;(i===void 0||i-- >0)&&!(s=a.next()).done;)c.push(s.value)}catch(m){u={error:m}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(u)throw u.error}}return c},Gr=function(){for(var n=[],i=0;i<arguments.length;i++)n=n.concat(Ct(arguments[i]));return n},Kr=function(){for(var n=0,i=0,o=arguments.length;i<o;i++)n+=arguments[i].length;for(var a=Array(n),s=0,i=0;i<o;i++)for(var c=arguments[i],u=0,m=c.length;u<m;u++,s++)a[s]=c[u];return a},Ur=function(n,i,o){if(o||arguments.length===2)for(var a=0,s=i.length,c;a<s;a++)(c||!(a in i))&&(c||(c=Array.prototype.slice.call(i,0,a)),c[a]=i[a]);return n.concat(c||Array.prototype.slice.call(i))},X=function(n){return this instanceof X?(this.v=n,this):new X(n)},zr=function(n,i,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=o.apply(n,i||[]),s,c=[];return s={},u("next"),u("throw"),u("return"),s[Symbol.asyncIterator]=function(){return this},s;function u(_){a[_]&&(s[_]=function(Q){return new Promise(function(Ot,Ei){c.push([_,Q,Ot,Ei])>1||m(_,Q)})})}function m(_,Q){try{S(a[_](Q))}catch(Ot){Y(c[0][3],Ot)}}function S(_){_.value instanceof X?Promise.resolve(_.value.v).then(f,O):Y(c[0][2],_)}function f(_){m("next",_)}function O(_){m("throw",_)}function Y(_,Q){_(Q),c.shift(),c.length&&m(c[0][0],c[0][1])}},Vr=function(n){var i,o;return i={},a("next"),a("throw",function(s){throw s}),a("return"),i[Symbol.iterator]=function(){return this},i;function a(s,c){i[s]=n[s]?function(u){return(o=!o)?{value:X(n[s](u)),done:s==="return"}:c?c(u):u}:c}},$r=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n[Symbol.asyncIterator],o;return i?i.call(n):(n=typeof Ve=="function"?Ve(n):n[Symbol.iterator](),o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o);function a(c){o[c]=n[c]&&function(u){return new Promise(function(m,S){u=n[c](u),s(m,S,u.done,u.value)})}}function s(c,u,m,S){Promise.resolve(S).then(function(f){c({value:f,done:m})},u)}},Br=function(n,i){return Object.defineProperty?Object.defineProperty(n,"raw",{value:i}):n.raw=i,n};var t=Object.create?function(n,i){Object.defineProperty(n,"default",{enumerable:!0,value:i})}:function(n,i){n.default=i};Jr=function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var o in n)o!=="default"&&Object.prototype.hasOwnProperty.call(n,o)&&$e(i,n,o);return t(i,n),i},Zr=function(n){return n&&n.__esModule?n:{default:n}},Yr=function(n,i,o,a){if(o==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof i=="function"?n!==i||!a:!i.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return o==="m"?a:o==="a"?a.call(n):a?a.value:i.get(n)},Qr=function(n,i,o,a,s){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof i=="function"?n!==i||!s:!i.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?s.call(n,o):s?s.value=o:i.set(n,o),o},Xr=function(n,i){if(i===null||typeof i!="object"&&typeof i!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?i===n:n.has(i)},r("__extends",jr),r("__assign",qr),r("__rest",Dr),r("__decorate",Er),r("__param",Lr),r("__metadata",Hr),r("__awaiter",Nr),r("__generator",Fr),r("__exportStar",Wr),r("__createBinding",$e),r("__values",Ve),r("__read",Ct),r("__spread",Gr),r("__spreadArrays",Kr),r("__spreadArray",Ur),r("__await",X),r("__asyncGenerator",zr),r("__asyncDelegator",Vr),r("__asyncValues",$r),r("__makeTemplateObject",Br),r("__importStar",Jr),r("__importDefault",Zr),r("__classPrivateFieldGet",Yr),r("__classPrivateFieldSet",Qr),r("__classPrivateFieldIn",Xr)})});var Re=g(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.compose=ee.CompositeTransducer=void 0;var kt=class{constructor(e,t){this.a=e,this.b=t}async_(e){return this.b.async_(this.a.async_(e))}sync(e){return this.b.sync(this.a.sync(e))}};ee.CompositeTransducer=kt;function Ui(r,e){return new kt(r,e)}ee.compose=Ui});var en=g(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.decompose=void 0;var zi=Re();function*It(r){r instanceof zi.CompositeTransducer?(yield*It(r.a),yield*It(r.b)):yield r}Je.decompose=It});var R=g(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.syncReturned=l.asyncReturned=l.isReturned=l.isYielded=l.AsyncIteratorHandler=l.by=l.toAsyncIterable=l.isArrayLike=l.asyncIterable=l.iterable=l.toIterable=l.isPromiseLike=l.isAsyncIterable=l.isIterable=l.value=l.key=l.comparators=l.descending=l.ascending=void 0;var N=v();function Ze(r,e){return r<e?-1:r>e?1:0}l.ascending=Ze;function Vi(r,e){return r<e?1:r>e?-1:0}l.descending=Vi;function $i(...r){return(e,t)=>{for(let n of r){let i=n(e,t);if(i!=0)return i}return 0}}l.comparators=$i;function Bi(r){return Object.assign(e=>e[r],{name:r})}l.key=Bi;function Ji(r){return e=>e[r]}l.value=Ji;function Zi(r){return typeof r=="object"&&Symbol.iterator in r}l.isIterable=Zi;function Yi(r){return typeof r=="object"&&Symbol.asyncIterator in r}l.isAsyncIterable=Yi;function Qi(r){return typeof r=="object"&&"then"in r}l.isPromiseLike=Qi;function Xi(...r){return r}l.toIterable=Xi;function*eo(r){for(let e=0;e<r.length;e++)yield r[e]}l.iterable=eo;function to(r){return N.__asyncGenerator(this,arguments,function*(){for(let t of r)yield yield N.__await(t)})}l.asyncIterable=to;function ro(r){return typeof r=="object"&&typeof r.length=="number"}l.isArrayLike=ro;function no(r){return N.__asyncGenerator(this,arguments,function*(){yield yield N.__await(r)})}l.toAsyncIterable=no;function io(r,e=Ze){return typeof r=="function"?ao(r,e):oo(r,e)}l.by=io;function oo(r,e=Ze){return(t,n)=>e(t[r],n[r])}function ao(r,e=Ze){return(t,n)=>e(r(t),r(n))}var tn=class{constructor(){this.handlers=[],this.state=[]}value(e){this.newState({value:e,done:!1})}error(e){this.newState(e)}close(e){this.newState({value:e,done:!0})}[Symbol.asyncIterator](){return this}next(){return new Promise((e,t)=>{this.newHandler([e,t])})}newState(e){let t=this.handlers.shift();if(typeof t=="undefined")return this.state.push(e);let n=this.state.shift();if(typeof n=="undefined")return this.consume(e,t);this.consume(n,t),this.newState(e)}newHandler(e){let t=this.state.shift();if(typeof t=="undefined")return this.handlers.push(e);let n=this.handlers.shift();if(typeof n=="undefined")return this.consume(t,e);this.consume(t,n),this.newHandler(e)}consume(e,[t,n]){e instanceof Error?n(e):t(e)}};l.AsyncIteratorHandler=tn;function so(r){return r&&typeof r=="object"&&"yielded"in r}l.isYielded=so;function co(r){return r&&typeof r=="object"&&"returned"in r}l.isReturned=co;function uo(r){return N.__asyncGenerator(this,arguments,function*(){for(;;){let{value:t,done:n}=yield N.__await(r.next());if(n){yield yield N.__await({returned:t});break}else yield yield N.__await({yielded:t})}})}l.asyncReturned=uo;function*lo(r){for(;;){let{value:e,done:t}=r.next();if(t){yield{returned:e};break}else yield{yielded:e}}}l.syncReturned=lo});var rn=g(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.dedupe=re.DedupeTransducer=void 0;var te=v(),po=R(),Rt=class{constructor(e){this.comparator=e}async_(e){return te.__asyncGenerator(this,arguments,function*(){var n,i;let o;try{for(var a=te.__asyncValues(e),s;s=yield te.__await(a.next()),!s.done;){let c=s.value;typeof o=="undefined"?yield yield te.__await(c):this.comparator(c,o)!==0&&(yield yield te.__await(c)),o=c}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=a.return)&&(yield te.__await(i.call(a)))}finally{if(n)throw n.error}}})}*sync(e){let t;for(let n of e)typeof t=="undefined"?yield n:this.comparator(n,t)!==0&&(yield n),t=n}};re.DedupeTransducer=Rt;function fo(r=po.ascending){return new Rt(r)}re.dedupe=fo});var nn=g(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.drop=ne.DropTransducer=void 0;var Me=v(),Mt=class{constructor(e){if(this.count=e,typeof e=="undefined")throw new Error("Count can not be undefined")}async_(e){return Me.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=Me.__asyncValues(e),a;a=yield Me.__await(o.next()),!a.done;){let s=a.value;--this.count<0&&(yield yield Me.__await(s))}}catch(s){n={error:s}}finally{try{a&&!a.done&&(i=o.return)&&(yield Me.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)--this.count<0&&(yield t)}};ne.DropTransducer=Mt;function go(r){return new Mt(r)}ne.drop=go});var on=g(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.dropWhile=ie.DropWhileTransducer=void 0;var je=v(),jt=class{constructor(e){this.predicate=e}async_(e){return je.__asyncGenerator(this,arguments,function*(){var n,i;let o=!0;try{for(var a=je.__asyncValues(e),s;s=yield je.__await(a.next()),!s.done;){let c=s.value;o&&(o=this.predicate(c)),o||(yield yield je.__await(c))}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=a.return)&&(yield je.__await(i.call(a)))}finally{if(n)throw n.error}}})}*sync(e){let t=!0;for(let n of e)t&&(t=this.predicate(n)),t||(yield n)}};ie.DropWhileTransducer=jt;function yo(r){return new jt(r)}ie.dropWhile=yo});var Ye=g(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.accept=F.filter=F.FilterTransducer=void 0;var qe=v(),qt=class{constructor(e){this.predicate=e}async_(e){return qe.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=qe.__asyncValues(e),a;a=yield qe.__await(o.next()),!a.done;){let s=a.value;this.predicate(s)&&(yield yield qe.__await(s))}}catch(s){n={error:s}}finally{try{a&&!a.done&&(i=o.return)&&(yield qe.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)this.predicate(t)&&(yield t)}};F.FilterTransducer=qt;function an(r){return new qt(r)}F.filter=an;F.accept=an});var Et=g(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.first=ae.FirstTransducer=void 0;var oe=v(),Dt=class{async_(e){return oe.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=oe.__asyncValues(e),a;a=yield oe.__await(o.next()),!a.done;){let s=a.value;return yield oe.__await(yield yield oe.__await(s))}}catch(s){n={error:s}}finally{try{a&&!a.done&&(i=o.return)&&(yield oe.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)return yield t}};ae.FirstTransducer=Dt;function mo(){return new Dt}ae.first=mo});var sn=g(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.find=void 0;var ho=Ye(),bo=Et(),xo=Re();function vo(r){return(0,xo.compose)((0,ho.filter)(r),(0,bo.first)())}Qe.find=vo});var cn=g(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.flatMap=se.FlatMapTransducer=void 0;var V=v(),Lt=class{constructor(e){this.mapper=e}async_(e){return V.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=V.__asyncValues(e),a;a=yield V.__await(o.next()),!a.done;){let s=a.value;yield V.__await(yield*V.__asyncDelegator(V.__asyncValues(this.mapper(s))))}}catch(s){n={error:s}}finally{try{a&&!a.done&&(i=o.return)&&(yield V.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)yield*this.mapper(t)}};se.FlatMapTransducer=Lt;function wo(r){return new Lt(r)}se.flatMap=wo});var ln=g(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.transducer=W.identity=W.IdentityTransducer=void 0;var Ht=class{async_(e){return e}sync(e){return e}};W.IdentityTransducer=Ht;function un(){return new Ht}W.identity=un;W.transducer=un});var Ft=g(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.last=ce.LastTransducer=void 0;var De=v(),Nt=class{async_(e){return De.__asyncGenerator(this,arguments,function*(){var n,i;let o;try{for(var a=De.__asyncValues(e),s;s=yield De.__await(a.next()),!s.done;)o=s.value}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=a.return)&&(yield De.__await(i.call(a)))}finally{if(n)throw n.error}}o!==void 0&&(yield yield De.__await(o))})}*sync(e){let t;for(t of e);t!==void 0&&(yield t)}};ce.LastTransducer=Nt;function _o(){return new Nt}ce.last=_o});var dn=g(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.map=ue.MapTransducer=void 0;var Ee=v(),Wt=class{constructor(e){this.mapper=e}async_(e){return Ee.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=Ee.__asyncValues(e),a;a=yield Ee.__await(o.next()),!a.done;){let s=a.value;yield yield Ee.__await(this.mapper(s))}}catch(s){n={error:s}}finally{try{a&&!a.done&&(i=o.return)&&(yield Ee.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)yield this.mapper(t)}};ue.MapTransducer=Wt;function To(r){return new Wt(r)}ue.map=To});var Kt=g(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.scan=de.ScanTransducer=void 0;var le=v(),Gt=class{constructor(e,t){this.reducer=e,this.seed=t}async_(e){return le.__asyncGenerator(this,arguments,function*(){var n,i;let o=this.seed;yield yield le.__await(o);try{for(var a=le.__asyncValues(e),s;s=yield le.__await(a.next()),!s.done;){let c=s.value;yield yield le.__await(o=this.reducer(o,c))}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=a.return)&&(yield le.__await(i.call(a)))}finally{if(n)throw n.error}}})}*sync(e){let t=this.seed;yield t;for(let n of e)yield t=this.reducer(t,n)}};de.ScanTransducer=Gt;function Po(r,e){return new Gt(r,e)}de.scan=Po});var pn=g(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.reduce=void 0;var So=Re(),Oo=Ft(),Ao=Kt();function Co(r,e){return(0,So.compose)((0,Ao.scan)(r,e),(0,Oo.last)())}Xe.reduce=Co});var fn=g(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});et.reject=void 0;var ko=Ye();function Io(r){return new ko.FilterTransducer(e=>!r(e))}et.reject=Io});var gn=g(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.sum=D.subtract=D.add=D.increment=void 0;function Ro(r){return r+1}D.increment=Ro;function Mo(r,e){return e===void 0?t=>r+t:r+e}D.add=Mo;function jo(r,e){return e===void 0?t=>t-r:r-e}D.subtract=jo;var qo=(r,e)=>r+e;D.sum=qo});var nt=g(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.AsyncSequence=P.Sequence=P.sequence=P.range=P.repeat=P.iterate=void 0;var Ut=gn(),zt=R(),yn=Le();function*tt(r,e){for(;;)yield e,e=r(e)}P.iterate=tt;function*Do(r){for(;;)yield r()}P.repeat=Do;function*Eo(r,e,t=1){if(t===0)throw new Error("step can not be 0");if(e===void 0)yield*tt((0,Ut.add)(t),r);else{let n=Math.abs(t);e<r?yield*Vt(tt((0,Ut.subtract)(n),r),(0,yn.takeWhile)(i=>i>=e)):yield*Vt(tt((0,Ut.add)(n),r),(0,yn.takeWhile)(i=>i<=e))}}P.range=Eo;function Vt(r,...e){return(0,zt.isIterable)(r)?new rt(r,e):(0,zt.isArrayLike)(r)?new rt((0,zt.iterable)(r),e):new $t(r,e)}P.sequence=Vt;var rt=class{constructor(e,t){this.source=e,this.transducers=t}[Symbol.iterator](){return this.transducers.reduce((e,t)=>t.sync(e),this.source)[Symbol.iterator]()}};P.Sequence=rt;var $t=class{constructor(e,t){this.source=e,this.transducers=t}[Symbol.asyncIterator](){return this.transducers.reduce((e,t)=>t.async_(e),this.source)[Symbol.asyncIterator]()}};P.AsyncSequence=$t});var bn=g(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.single=void 0;var mn=v(),Lo=R(),hn=nt();function Ho(r,...e){return(0,Lo.isIterable)(r)?No((0,hn.sequence)(r,...e)):Fo((0,hn.sequence)(r,...e))}it.single=Ho;function No(r){for(let e of r)return e;throw new Error("Expected a single value")}function Fo(r){var e,t,n,i;return mn.__awaiter(this,void 0,void 0,function*(){try{for(e=mn.__asyncValues(r);t=yield e.next(),!t.done;)return t.value}catch(o){n={error:o}}finally{try{t&&!t.done&&(i=e.return)&&(yield i.call(e))}finally{if(n)throw n.error}}throw new Error("Expected a single value")})}});var Bt=g(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.array=void 0;var xn=v(),vn=R(),wn=nt();function Wo(r,...e){return(0,vn.isIterable)(r)||(0,vn.isArrayLike)(r)?Go((0,wn.sequence)(r,...e)):Ko((0,wn.sequence)(r,...e))}ot.array=Wo;function Go(r){let e=[];for(let t of r)e.push(t);return e}function Ko(r){var e,t,n,i;return xn.__awaiter(this,void 0,void 0,function*(){let o=[];try{for(e=xn.__asyncValues(r);t=yield e.next(),!t.done;){let a=t.value;o.push(a)}}catch(a){n={error:a}}finally{try{t&&!t.done&&(i=e.return)&&(yield i.call(e))}finally{if(n)throw n.error}}return o})}});var Tn=g(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.sort=pe.SortTransducer=void 0;var He=v(),Uo=R(),_n=Bt(),Jt=class{constructor(e){this.comparator=e}async_(e){return He.__asyncGenerator(this,arguments,function*(){let n=yield He.__await((0,_n.array)(e));n.sort(this.comparator),yield He.__await(yield*He.__asyncDelegator(He.__asyncValues(n)))})}*sync(e){let t=(0,_n.array)(e);t.sort(this.comparator),yield*t}};pe.SortTransducer=Jt;function zo(r=Uo.ascending){return new Jt(r)}pe.sort=zo});var Pn=g(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.take=fe.TakeTransducer=void 0;var $=v(),Zt=class{constructor(e){if(this.count=e,typeof e=="undefined")throw new Error("Count can not be undefined")}async_(e){return $.__asyncGenerator(this,arguments,function*(){var n,i;if(this.count<1)return yield $.__await(void 0);try{for(var o=$.__asyncValues(e),a;a=yield $.__await(o.next()),!a.done;){let s=a.value;if(yield yield $.__await(s),--this.count<1)return yield $.__await(void 0)}}catch(s){n={error:s}}finally{try{a&&!a.done&&(i=o.return)&&(yield $.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){if(!(this.count<1)){for(let t of e)if(yield t,--this.count<1)return}}};fe.TakeTransducer=Zt;function Vo(r){return new Zt(r)}fe.take=Vo});var Sn=g(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.takeWhile=ye.TakeWhileTransducer=void 0;var ge=v(),Yt=class{constructor(e){this.predicate=e}async_(e){return ge.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=ge.__asyncValues(e),a;a=yield ge.__await(o.next()),!a.done;){let s=a.value;if(this.predicate(s))yield yield ge.__await(s);else return yield ge.__await(void 0)}}catch(s){n={error:s}}finally{try{a&&!a.done&&(i=o.return)&&(yield ge.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)if(this.predicate(t))yield t;else return}};ye.TakeWhileTransducer=Yt;function $o(r){return new Yt(r)}ye.takeWhile=$o});var An=g(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0})});var Qt=g(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.container=G.lazy=G.replace=void 0;function Cn(r,e,t){return Object.defineProperty(r,e,{value:t})}G.replace=Cn;function kn(r,e,t){if(typeof t.get=="undefined")throw new Error("@lazy can only decorate getter methods");return Object.defineProperty(r,e,Object.assign(Object.assign({},t),{get(){return Cn(this,e,t.get.call(this))[e]}}))}G.lazy=kn;function Bo(r){return Object.keys(r).reduce((e,t)=>kn(e,t,{configurable:!0,get:()=>r[t](e)}),{})}G.container=Bo});var Ln=g(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.AVLTree=void 0;var In=v(),at=R(),Rn=Qt(),E=class{constructor(e){this.comparator=e}static empty(e=at.ascending){return new Mn(e)}static create(e,t,n=at.ascending){let i=E.empty(n);return new k(n,e,t,i,i)}static of(e,t=at.ascending){return E.preSorted(e.sort((0,at.by)(0)),t,E.empty(t))}static preSorted(e,t,n){let i=e.length;switch(i){case 0:return n;case 1:{let[[o,a]]=e;return new k(t,o,a,n,n)}default:{let o=Math.floor(i/2),a=E.preSorted(e.slice(0,o),t,n),s=E.preSorted(e.slice(o+1),t,n),[c,u]=e[o];return new k(t,c,u,a,s)}}}};st.AVLTree=E;var Mn=class extends E{constructor(e){super(e);this.isEmpty=!0,this.height=0,this.balance=0}insert(e,t){return new k(this.comparator,e,t,this,this)}contains(e){return!1}lookup(e){}delete(e){return{tree:this}}first(){}last(){}removeFirst(){return{tree:this}}removeLast(){return{tree:this}}toString(){return""}*keys(){}*values(){}*entries(){return[]}},k=class extends E{constructor(e,t,n,i,o){super(e);this.key=t,this.value=n,this.left=i,this.right=o,this.isEmpty=!1}insert(e,t){let n=this.comparator(e,this.key);return n===0?new k(this.comparator,e,t,this.left,this.right):n<0?this.replaceLeft(this.left.insert(e,t)):this.replaceRight(this.right.insert(e,t))}contains(e){let t=this.comparator(e,this.key);return t===0?!0:t<0?this.left.contains(e):this.right.contains(e)}lookup(e){let t=this.comparator(e,this.key);return t===0?this.value:t<0?this.left.lookup(e):this.right.lookup(e)}delete(e){let t=this.comparator(e,this.key);if(t===0){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};let{tree:a,key:s,value:c}=this.left.removeLast();return{tree:Xt(new k(this.comparator,s,c,a,this.right)),key:this.key,value:this.value}}if(t<0){let{tree:a,key:s,value:c}=this.left.delete(e);return{tree:this.replaceLeft(a),key:s,value:c}}let{tree:n,key:i,value:o}=this.right.delete(e);return{tree:this.replaceRight(n),key:i,value:o}}first(){return this.left.isEmpty?this.value:this.left.first()}last(){return this.right.isEmpty?this.value:this.right.last()}removeFirst(){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};let{tree:e,key:t,value:n}=this.left.removeFirst();return{tree:this.replaceLeft(e),key:t,value:n}}removeLast(){if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};let{tree:e,key:t,value:n}=this.right.removeLast();return{tree:this.replaceRight(e),key:t,value:n}}replaceLeft(e){return Xt(new k(this.comparator,this.key,this.value,e,this.right))}replaceRight(e){return Xt(new k(this.comparator,this.key,this.value,this.left,e))}toString(){return`(${this.left} ${this.key}=${this.value} ${this.right})`}get balance(){return this.left.height-this.right.height}get height(){return Math.max(this.left.height,this.right.height)+1}*keys(){yield*this.left.keys(),yield this.key,yield*this.right.keys()}*values(){yield*this.left.values(),yield this.value,yield*this.right.values()}*entries(){yield*this.left.entries(),yield[this.key,this.value],yield*this.right.entries()}};In.__decorate([Rn.lazy],k.prototype,"balance",null);In.__decorate([Rn.lazy],k.prototype,"height",null);function Xt(r){let e=r.balance;return e==-2?Zo(r):e==2?Jo(r):r}function Jo(r){let e=r.left.balance;return e==-1?Yo(r):e==1?jn(r):r}function Zo(r){let e=r.right.balance;return e==1?Qo(r):e==-1?qn(r):r}function jn(r){return En(r)}function Yo(r){let e=Dn(r.left);return jn(r.replaceLeft(e))}function qn(r){return Dn(r)}function Qo(r){let e=En(r.right);return qn(r.replaceRight(e))}function Dn(r){let e=r.right,t=e.left,n=r.replaceRight(t);return e.replaceLeft(n)}function En(r){let e=r.left,t=e.right,n=r.replaceLeft(t);return e.replaceRight(n)}});var Nn=g(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.unique=me.UniqueTransducer=void 0;var Ne=v(),Xo=R(),Hn=Ln(),er=class{constructor(e){this.comparator=e}async_(e){return Ne.__asyncGenerator(this,arguments,function*(){var n,i;let o=Hn.AVLTree.empty(this.comparator);try{for(var a=Ne.__asyncValues(e),s;s=yield Ne.__await(a.next()),!s.done;){let c=s.value;o.contains(c)||(o=o.insert(c,void 0),yield yield Ne.__await(c))}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=a.return)&&(yield Ne.__await(i.call(a)))}finally{if(n)throw n.error}}})}*sync(e){let t=Hn.AVLTree.empty(this.comparator);for(let n of e)t.contains(n)||(t=t.insert(n,void 0),yield n)}};me.UniqueTransducer=er;function ea(r=Xo.ascending){return new er(r)}me.unique=ea});var Fn=g(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.WindowedTransducer=be.windowed=void 0;var he=v();function ta(r,e=1,t=!1){return new tr(r,e,t)}be.windowed=ta;var tr=class{constructor(e,t,n){this.size=e,this.step=t,this.remainder=n}async_(e){return he.__asyncGenerator(this,arguments,function*(){var n,i;let o=[],a=0;try{for(var s=he.__asyncValues(e),c;c=yield he.__await(s.next()),!c.done;){let u=c.value;if(a>0){a--;continue}o.push(u),o.length===this.size&&(yield yield he.__await([...o]),o=o.slice(this.step),this.step>this.size&&(a=this.step-this.size))}}catch(u){n={error:u}}finally{try{c&&!c.done&&(i=s.return)&&(yield he.__await(i.call(s)))}finally{if(n)throw n.error}}this.remainder&&(yield yield he.__await([...o]))})}*sync(e){let t=[],n=0;for(let i of e){if(n>0){n--;continue}t.push(i),t.length===this.size&&(yield[...t],t=t.slice(this.step),this.step>this.size&&(n=this.step-this.size))}this.remainder&&(yield[...t])}};be.WindowedTransducer=tr});var Gn=g(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.zipWithIndex=K.zip=K.ZipTransducer=void 0;var ct=v(),Wn=R(),ra=nt(),ut=class{constructor(e){this.other=e}async_(e){return ct.__asyncGenerator(this,arguments,function*(){if(!(0,Wn.isAsyncIterable)(this.other))throw new Error("Unsupported operation exception");let n=e[Symbol.asyncIterator](),i=this.other[Symbol.asyncIterator]();for(;;){let[o,a]=yield ct.__await(Promise.all([n.next(),i.next()]));if(o.done||a.done)return yield ct.__await(void 0);yield yield ct.__await([o.value,a.value])}})}*sync(e){if(!(0,Wn.isIterable)(this.other))throw new Error("Unsupported operation exception");let t=e[Symbol.iterator](),n=this.other[Symbol.iterator]();for(;;){let i=t.next(),o=n.next();if(i.done||o.done)return;yield[i.value,o.value]}}};K.ZipTransducer=ut;function na(r){return new ut(r)}K.zip=na;function ia(){return new ut((0,ra.range)(0))}K.zipWithIndex=ia});var Le=g(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});var x=v();x.__exportStar(Re(),b);x.__exportStar(en(),b);x.__exportStar(rn(),b);x.__exportStar(nn(),b);x.__exportStar(on(),b);x.__exportStar(Ye(),b);x.__exportStar(sn(),b);x.__exportStar(Et(),b);x.__exportStar(cn(),b);x.__exportStar(ln(),b);x.__exportStar(Ft(),b);x.__exportStar(dn(),b);x.__exportStar(pn(),b);x.__exportStar(fn(),b);x.__exportStar(Kt(),b);x.__exportStar(bn(),b);x.__exportStar(Tn(),b);x.__exportStar(Pn(),b);x.__exportStar(Sn(),b);x.__exportStar(An(),b);x.__exportStar(Nn(),b);x.__exportStar(Fn(),b);x.__exportStar(Gn(),b)});var nr=g(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.caching=we.cache=void 0;function aa(r,e,t){if(typeof t.value!="function")throw new Error("@cache can only decorate methods");let n=new WeakMap;function i(o){let a=n.get(o);if(a)return a;let s=new Map;return n.set(o,s),s}return Object.defineProperty(r,e,Object.assign(Object.assign({},t),{value:function(...o){let a=JSON.stringify(o),s=i(this),c=s.get(a);if(typeof c!="undefined"||s.has(a))return c;let u=t.value.call(this,...o);return s.set(a,u),u}}))}we.cache=aa;function sa(r){let e=new Map;return function(...t){let n=JSON.stringify(t),i=e.get(n);if(typeof i!="undefined"||e.has(n))return i;let o=r(...t);return e.set(n,o),o}}we.caching=sa});var Ti=g(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.Uri=d.HostHandler=d.host=d.replace=d.const_=d.modify=d.notFound=d.ok=d.response=d.delete_=d.patch=d.put=d.post=d.get=d.request=d.stringChunk=d.StringBody=d.isBody=void 0;var bi=v();typeof Symbol.asyncIterator=="undefined"&&(Symbol.asyncIterator=Symbol.for("Symbol.asyncIterator"));function ka(r){return typeof r=="object"&&"text"in r&&Symbol.asyncIterator in r}d.isBody=ka;var bt=class{constructor(e){this.value=e}text(){return Promise.resolve(this.value)}[Symbol.asyncIterator](){return bi.__asyncGenerator(this,arguments,function*(){yield yield bi.__await(xi(this.value))})}};d.StringBody=bt;function xi(r){return{text:()=>r,data:()=>new TextEncoder().encode(r)}}d.stringChunk=xi;function Pe(r,e,t,n){return{method:r,uri:typeof e=="string"?new Se(e):e,headers:t||{},body:typeof n=="string"?new bt(n):n}}d.request=Pe;function Ia(r,e){return Pe("GET",r,e)}d.get=Ia;function Ra(r,e,t){return Pe("POST",r,e,t)}d.post=Ra;function Ma(r,e,t){return Pe("PUT",r,e,t)}d.put=Ma;function ja(r,e,t){return Pe("PATCH",r,e,t)}d.patch=ja;function qa(r,e){return Pe("DELETE",r,e)}d.delete_=qa;function hr(r,e,t){return{status:r,headers:e||{},body:typeof t=="string"?new bt(t):t}}d.response=hr;function Da(r,e){return hr(200,r,e)}d.ok=Da;function Ea(r,e){return hr(404,r,e)}d.notFound=Ea;function br(r,e,t){return Object.assign({},r,{[e]:t(r[e])})}d.modify=br;function vi(r){return()=>r}d.const_=vi;function wi(r,e){return t=>br(t,r,vi(e))}d.replace=wi;function La(r){if(typeof r.uri.authority!="undefined")return r.uri.authority;let e=r.headers.Host;if(typeof e!="string")throw new Error("Bad Request");return e}d.host=La;var _i=class{constructor(e,t){this.handler=e,this.host=t}handle(e){return this.handler.handle(br(e,"headers",wi("Host",this.host)))}};d.HostHandler=_i;var Se=class{constructor(e){let t=Se.RFC_3986.exec(e);if(!t)throw new Error(`Invalid Uri: ${e}`);let[,,n,,i,o,,a,,s]=t;this.scheme=n,this.authority=i,this.path=o,this.query=a,this.fragment=s}toString(){let e=[];return typeof this.scheme!="undefined"&&e.push(this.scheme,":"),typeof this.authority!="undefined"&&e.push("//",this.authority),e.push(this.path),typeof this.query!="undefined"&&e.push("?",this.query),typeof this.fragment!="undefined"&&e.push("#",this.fragment),e.join("")}toJSON(){return this.toString()}};d.Uri=Se;Se.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/});var Kn=q(Le()),Un=q(R()),oa=q(Le());function rr(r){switch(typeof r){case"undefined":return!0;case"string":return r.trim()==="";case"number":return isNaN(r);case"object":{if(r==null)return!0;if(h.isObject(r))return Object.keys(r).length===0;if(Array.isArray(r))return r.length===0}}return!1}var ve=class{static noWhitespace(e){return e&&typeof e=="string"?e.replace(/\s+/g,""):""}static startWith(e,t){return e?e.substring(0,t.length)===t:e===t}static endsWith(e,t){return e.substring(e.length-t.length,e.length)===t}static isEmpty(e){return e===void 0||e===null?!0:e.trim().length===0}static isEmail(e){return typeof e=="string"&&this.validEmailPattern.test(e)}static isLowerCase(e){return e===e.toLowerCase()&&e!==e.toUpperCase()}static isUpperCase(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}static kebabCase(e){return ve.delimiterCase(e,"-")}static snakeCase(e){return ve.delimiterCase(e,"_")}static delimiterCase(e,t){return e.replace(/([A-Z][a-z]+|\d+)/gm,`${t}$1`).replace(new RegExp(`^${t}`),"").toLowerCase()}static titleCase(e){return ve.isEmpty(e)?"":e.replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase())}static camelCase(e){return ve.isEmpty(e)?"":e.replace(/([A-Za-z]+|\d+)/gm,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()).replace(new RegExp("^."),t=>t.toLowerCase()).replace(new RegExp(/[_\-\s]/g),"")}},xe=ve;xe.validEmailPattern=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function Fe(r,e,t){if(e(r))return t(r);switch(typeof r){case"undefined":return;case"object":{if(r===null)return null;if(Array.isArray(r))return r.map(n=>Fe(n,e,t));if(h.isObject(r))return h.keys(r).sort().reduce((n,i)=>{let o=r[i];return n[i]=Fe(o,e,t),n},{})}}return r}function lt(r,e){switch(typeof r){case"undefined":return;case"object":{if(r===null)return null;if(Array.isArray(r))return r.map(t=>lt(t,e));if(h.isObject(r))return h.keys(r).sort().reduce((t,n)=>{let i=r[n];return t[e(String(n))]=lt(i,e),t},{})}}return r}var h=class{static isObject(e){return e&&typeof e=="object"&&(e.constructor===Object||/Object.*native/.test(e.constructor.toString()))}static keys(e){return Object.keys(e)}static values(e){return Object.keys(e).map(t=>e[t])}static entries(e){return Object.keys(e).map(t=>[t,e[t]])}static removeEmpty(e){return e&&(h.isObject(e)?Object.keys(e).reduce((t,n)=>{let i=h.removeEmpty(e[n]);return rr(i)||(t[n]=i),t},{}):e)}static sort(e){return e&&(Array.isArray(e)?e.map(h.sort):h.isObject(e)?Object.keys(e).sort().reduce((t,n)=>{let i=e[n];return t[n]=h.sort(i),t},{}):e)}static toLowerCase(e){return typeof e=="string"?e.toLowerCase():Array.isArray(e)?e.map(h.toLowerCase):p(()=>h.isObject(e))?Object.entries(e).reduce((t,[n,i])=>(t[n]=h.toLowerCase(i),t),{}):e}static snakeCase(e){return lt(e,xe.snakeCase)}static camelCase(e){return lt(e,xe.camelCase)}static filter(e,t){let n=h.keys(e).filter(t);return h.pick(e,...n)}static omit(e,...t){return t.reduce((n,i)=>(Reflect.deleteProperty(n,i),n),e)}static pick(e,...t){return t.reduce((n,i)=>(n[i]=e[i],n),{})}};var U=class{static from(e){return Array.from(e)}static find(e,t){if(e.find)return e.find(t);let[n]=e.filter(t);return n}static findLastIndex(e,t){let n=[...e].reverse().findIndex(t);return n===-1?n:e.length-n-1}static toObject(e){return e.reduce((t,n)=>(Object.keys(n).forEach(i=>{i in t||(t[i]=n[i])}),t),{})}static flatten(e){return e.reduce((t,n)=>t.concat(n),[])}static flatMap(e,t){return e.flatMap?e.flatMap(t):U.flatten(e.map(t))}static unique(e){return Array.from(new Set(e))}static clean(e){return e.filter(Boolean)}static trim(e){return e.map(t=>t.trim())}static includes(e,t){return"includes"in e?e.includes(t):e.indexOf(t)!==-1}static first(e){return e[0]}static last(e){return e[e.length-1]}static safeReverse(e){return e?e.slice().reverse():[]}static shuffle(e){return e.map(t=>({value:t,order:Math.random()})).sort((0,Un.by)("order")).map(({value:t})=>t)}};function p(r,e=void 0){try{let t=r();return typeof t=="undefined"?e:t}catch(t){return e}}var M=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof module!="undefined"?module:Function("return this")())();function zn(r,e,t){let n=r[e];return typeof n=="undefined"?r[e]=t:Array.isArray(n)?n.indexOf(t)==-1&&n.push(t):r[e]=[n,t],r}function Vn(r,e,t,n=i=>i){let i=[],o=0,a;for(;(a=r.exec(e))!=null;)i.push(n(e.substring(o,a.index))),i.push(t(a)),o=r.lastIndex;return i.push(n(e.substring(o))),i.join("")}var $n=q(nr()),Bn=q(Qt());function B(r=M){return r.triptease=r.triptease||{},r.triptease.onboard=r.triptease.onboard||{},{triptease:r.triptease,onboard:r.triptease.onboard}}var J;(function(n){n.Native="native",n.NonNative="non-native",n.NotImplemented="not-implemented"})(J||(J={}));function Jn(r,e){return p(()=>e.split(".").reduce((t,n)=>t[n],r))}function ca(r){return r==null?J.NotImplemented:typeof r=="function"?r.toString().includes("native code")?J.Native:J.NonNative:J.Native}var dt=class{static exposeApi(){let e=B(M).triptease;e.native||(e.native=dt)}static getProperty(e){let t=Jn(M,e);return ca(t)!==J.NonNative?t:Jn(dt.window,e)}static get window(){let e=M;if(!e.document)return e;try{let t=e.document,n=t.querySelector("[name='triptease.native']");if(n)return n.contentWindow;let i=t.createElement("iframe");return i.style.display="none",i.setAttribute("title","blank"),i.setAttribute("aria-hidden","true"),i.setAttribute("name","triptease.native"),t.documentElement.appendChild(i),i.contentWindow}catch(t){return e}}},A=dt;Ie([$n.cache],A,"getProperty",1),Ie([Bn.lazy],A,"window",1);var ua=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}\.\d{3}Z)?$/;function la(r){return Fe(r,e=>typeof e=="string"&&ua.test(e),e=>{let t=new Date(e);return isNaN(t.valueOf())?e:t})}var da=A.getProperty("JSON.parse"),pa=A.getProperty("JSON.stringify"),fa=A.getProperty("Date.prototype.toISOString"),L=class{static parse(e){return da(e)}static parseWithDates(e){return la(L.parse(e))}static stringify(e){return pa(this.clean(e))}static clean(e){return Fe(e,t=>{let n=typeof t;switch(n){case"undefined":case"string":case"number":case"boolean":return!0;case"object":{if(t===null)return!0;if(Array.isArray(t)||h.isObject(t))return!1;if("toJSON"in t)return!0}}throw new Error(`Illegal JsonValue: ${n} ${t} `)},t=>t instanceof Date?fa.call(t):t)}},I=class{static same(e,t){return L.stringify(e)===L.stringify(t)}static isSuperset(e,t){return e===null||t===null?I.same(e,t):Array.isArray(e)&&Array.isArray(t)?e.length>t.length?!1:e.every(n=>t.some(i=>I.isSuperset(n,i))):p(()=>h.isObject(e))&&p(()=>h.isObject(t))?Object.keys(e).reduce((n,i)=>n&&I.isSuperset(e[i],t[i]),!0):I.same(e,t)}static compress(e){let t=I.groupValues(e);return this.compressGrouped(t)}static compressGrouped(e){return Object.entries(e).reduce(({shared:t,unique:n},[i,o])=>{if(p(()=>h.isObject(o))){let a=I.compressGrouped(o);Object.keys(a.shared).length>0&&(t[i]=a.shared),a.unique.forEach((s,c)=>{n[c]=n[c]||{},Object.keys(s).length>0&&(n[c][i]=s)})}return Array.isArray(o)&&o.forEach((a,s)=>{n[s]=n[s]||{},U.unique(o.map(c=>L.stringify(c))).length===1?t[i]=a:a!==void 0&&(n[s][i]=a)}),{shared:t,unique:n}},{shared:{},unique:[]})}static groupValues(e){let t=Array.from(e.reduce((a,s)=>Object.keys(s).reduce((c,u)=>c.add(u),a),new Set)),[n,i]=e.reduce((a,s)=>t.reduce(([c,u],m)=>{let S=s[m];return p(()=>h.isObject(S))?(u[m]=u[m]||[],u[m].push(S)):(c[m]=c[m]||[],c[m].push(S)),[c,u]},a),[{},{}]),o=Object.entries(i).reduce((a,[s,c])=>(a[s]=I.groupValues(c),a),{});return C(C({},n),o)}static decompress(e){return e.unique.map(t=>this.merge(e.shared,t))}static merge(e,t){return[...Object.keys(e),...Object.keys(t)].reduce((i,o)=>{let a=e[o],s=t[o];return p(()=>h.isObject(a))&&p(()=>h.isObject(s))?i[o]=I.merge(a,s):i[o]=s!=null?s:a,i},{})}};function We(r,e=!0){return r?(r.indexOf("?")==0&&(r=r.substring(1,r.length)),r.split("&").map(function(t){return t.split("=")}).reduce(function(t,n){let i=n[0],o=n[1];if(!i)return t;let a=Zn(o),s=e?ga(a):a;return zn(t,Zn(i),s)},{})):{}}function Zn(r){return p(()=>decodeURIComponent(r.replace(/\+/g,"%20")),r)}function ga(r){try{return L.parse(r)}catch(e){return r}}function ya(r){return typeof r=="string"?r:JSON.stringify(r)}function Yn(r,e=!0){return Object.keys(h.removeEmpty(r)).map(t=>{let n=r[t],i=e?ya(n):n;return`${t}=${encodeURIComponent(i)}`}).join("&")}var or=class{constructor(e){let t=or.RFC_3986.exec(e);if(!t)throw new Error(`Invalid Uri: ${e}`);let[,,n,,i,o,,a,,s]=t;this.scheme=n,this.authority=i?new ir(i):void 0,this.path=o,this.query=a,this.fragment=s}toString(){let e=[];return typeof this.scheme!="undefined"&&e.push(this.scheme,":"),typeof this.authority!="undefined"&&e.push("//",this.authority.toString()),e.push(this.path),typeof this.query!="undefined"&&e.push("?",this.query),typeof this.fragment!="undefined"&&e.push("#",this.fragment),e.join("")}get host(){return this.authority&&this.authority.host}get port(){return this.authority&&this.authority.port}get userInfo(){return this.authority&&this.authority.userInfo}},_e=or;_e.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;var ar=class{constructor(e){let t=ar.RFC_3986.exec(e);if(!t)throw new Error(`Invalid Authority: ${e}`);let[,n,i,o]=t;this.userInfo=n,this.host=i,this.port=o}toString(){let e=[];return typeof this.userInfo!="undefined"&&e.push(this.userInfo,"@"),typeof this.host!="undefined"&&e.push(this.host),typeof this.port!="undefined"&&e.push(":",this.port),e.join("")}},ir=ar;ir.RFC_3986=/(?:([^@]+)@)?([^:]+)(?::([\d]+))?/;var Qn=A.getProperty("console.log"),ma=A.getProperty("console.error"),ha=A.getProperty("console.debug"),Xn=class{constructor(e=Qn,t=ma,n=ha||Qn){this.log=e;this.error=t;this.debug=n}},ei=class{constructor(){this.log=()=>{};this.error=()=>{};this.debug=()=>{}}},pt="triptease-debug",ba=256;function ti(r,e=pt){let t=p(()=>{var n;return We((n=r.location)==null?void 0:n.search,!1)[e]})||p(()=>{var n;return We(new _e((n=r.location)==null?void 0:n.originalHref).query,!1)[e]})||p(()=>{var n,i;return(i=(n=r.process)==null?void 0:n.env)==null?void 0:i.DEBUG})||p(()=>{var n;return((n=r.localStorage)==null?void 0:n.getItem)&&r.localStorage.getItem(e)})||p(()=>{var n;return((n=r.sessionStorage)==null?void 0:n.getItem)&&r.sessionStorage.getItem(e)})||"";return p(()=>t.substring(0,ba),"")}function ri(r=M){let e=ti(r,pt);return xe.isEmpty(e)?"":Yn({[pt]:e})}function xa(r){return ti(r,pt).split(",").map(e=>e.trim())}function ni(r){let e=r.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp("^"+e+"$")}function va(r,e=M){try{let t=xa(e),n=t.filter(i=>i[0]==="!").map(i=>i.substr(1));return n.length>0?!n.some(i=>ni(i).test(r)):t.some(i=>i==="true"||ni(i).test(r))}catch(t){return!1}}var ii=class{constructor(e){this.name=e;this.console=new Xn}debug(e,...t){this.console.debug(`[${this.name}] ${e}`,...t)}log(e,...t){this.console.log(`[${this.name}] ${e}`,...t)}error(e,...t){this.console.error(`[${this.name}] ${e}`,...t)}};function T(r,e=M){return va(r,e)?new ii(r):new ei}var Vs=A.getProperty("Date");var sr=class{now(){return new Date}};function oi(r){return new Promise(e=>{this.setTimeout(()=>{e()},r)})}var cr=class{constructor(e=new sr){this.clock=e;this.delay=oi.bind(this);this.delay=oi}task(e){return y(this,null,function*(){return yield this.delay(0),e()})}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}setInterval(e,t){return setInterval(e,t)}clearInterval(e){clearInterval(e)}requestIdleCallback(e,t){let n=t?t.timeout:1,i=this.clock.now().getTime()+n,o=this;return this.setTimeout(()=>{e({didTimeout:!1,timeRemaining(){return Math.max(0,50-(o.clock.now().getTime()-i))}})},n)}cancelIdleCallback(e){this.clearTimeout(e)}};var Zs=new cr;function ai(r={credentials:!1}){return e=>y(this,null,function*(){if(typeof fetch!="undefined"){let t=yield fetch(e.url,{method:e.method,headers:e.headers,body:e.body,credentials:r.credentials?"include":"omit"});return{status:t.status,statusDescription:t.statusText,body:yield t.text()}}else{let t=new XMLHttpRequest;return t.open(e.method,e.url,!0),e.headers&&Object.keys(e.headers).forEach(n=>{t.setRequestHeader(n,e.headers[n])}),t.withCredentials=r.credentials,t.send(e.body),new Promise((n,i)=>{t.addEventListener("load",o=>{n({status:t.status,statusDescription:t.statusText,body:t.responseText})}),t.addEventListener("error",o=>{i(o)})})}})}var ci=q(nr());var wa=/\${([^}]+)}/g;function si(r,e){return Vn(wa,r,([,t])=>{var n;return(n=e[t])!=null?n:`\${${t}}`})}var ur=class{static get(){return p(()=>{let e="7014.87142";return e?"v"+e:"latest"})}};var ui=class{constructor(e,t=ai()){this.logger=e;this.httpHandler=t;this.workers={}}createWorker(e,t){return y(this,null,function*(){let n=this.workers[e];return n||(this.workers[e]=yield this.create(t,{name:e}))})}create(e,t){return y(this,null,function*(){try{return new Worker(e,t)}catch(n){this.logger.debug("Failed to create Worker switching to Blob Worker because:",n.message);let i=`location.originalHref = "${e}";
`,a=(yield this.httpHandler({method:"GET",url:e})).body,s=new Blob([i,a],{type:"application/javascript"});return new Worker(URL.createObjectURL(s),t)}})}},ft=class{constructor(e,t=T("application-starter"),n=new ui(t),i=new li(e,t)){this.window=e;this.logging=t;this.workerFactory=n;this.waiter=i}start(e){return y(this,null,function*(){this.logging.debug(`ApplicationStarter starting app "${e.name}" (${e.type}), ${e.url}`);let t=this.window.document;if(e.type==="worker"){let o=yield this.workerFactory.createWorker(e.name,e.url);return e.startMessage&&(yield this.waiter.waitForMessage(e.startMessage,o)),this.logging.debug("ApplicationStarter returning worker"),o}let n=t.createElement(e.type);n.setAttribute("name",e.name),n.src=si(e.url,{onboard_version:ur.get()});let i=ft.DefaultOptions[e.type]||{};return Object.keys(i).forEach(o=>{n.setAttribute(o.toLowerCase(),i[o])}),this.addElement(n),e.startMessage?yield this.waiter.waitForMessage(e.startMessage):e.type==="script"&&(yield this.waiter.waitForLoadEvent(n)),n})}addElement(e){(this.window.document.body||this.window.document.documentElement).appendChild(e)}static create(e){var n;let t=B(e).triptease.onboard;return t.applicationStarter=(n=t.applicationStarter)!=null?n:new ft(e)}},Ge=ft;Ge.DefaultOptions={script:{defer:"",async:"",crossOrigin:"anonymous"},iframe:{style:"display: none;",sandbox:"allow-scripts allow-same-origin",title:"blank","aria-hidden":"true"}},Ie([ci.cache],Ge.prototype,"start",1);var li=class{constructor(e,t){this.window=e;this.logging=t}waitForLoadEvent(e){return this.logging.debug("MessageWaiter waiting for load/error event for",e),new Promise((t,n)=>{e.addEventListener("load",t),e.addEventListener("error",i=>n({name:"ScriptError",message:i.message||`Failed to load script "${e.src}"`}))})}waitForMessage(e,t=this.window){return this.logging.debug("MessageWaiter waiting for message",e),new Promise(n=>{this.logging.debug("MessageWaiter creating handler");let i=o=>{try{let a=o.data&&o.data.type,s=a===e;this.logging.debug(`ApplicationStarter message received "${a}", expecting "${e}", matched: ${s}`),s&&(t.removeEventListener("message",i),n(o.data))}catch(a){this.logging.debug("ApplicationStarter error in parsing message",a,o)}};this.logging.debug("MessageWaiter adding listener"),t.addEventListener("message",i)})}};var yc=new Set(["Unknown","PossibleIdentifier"]),mc=new Set(["HotelName","HotelCode","ChainCode"]);var j;(function(u){u.Search="Search",u.RoomsAndRates="RoomsAndRates",u.Confirmation="Confirmation",u.Checkout="Checkout",u.Payment="Payment",u.Group="Group",u.Advert="Advert",u.Partial="Partial",u.Unknown="Unknown"})(j||(j={}));var _a=[j.Payment,j.Confirmation,j.RoomsAndRates,j.Checkout,j.Search,j.Partial,j.Group,j.Unknown,j.Advert];function di(r){return _a.indexOf(r)}var H;(function(n){n.Singleton="Singleton",n.ApplicationHost="ApplicationHost",n.DataSource="DataSource"})(H||(H={}));var Ke="triptease.onboard.kernel";function Ta(r,e,t){return Object.defineProperty(r,e,{value:t})}function pi(r,e,t){return Ta(r,e,t)[e]}function fi(r){try{let{target:e,method:t}=dr(r.type);if(e&&t)return!0}catch(e){}return!1}var gt=class{constructor(e,t=T("worker")){this.worker=e;this.logger=t}addListener(e){this.worker.addEventListener("message",t=>{!fi(t.data)||e(t.data,this)})}send(e){try{this.worker.postMessage(e)}catch(t){this.worker.postMessage(JSON.parse(JSON.stringify(e)))}}},Te=class{constructor(e,t,n=lr,i=T("messaging")){this.listener=e;this.allowedOrigins=n;this.logger=i;this.target=this.listener!==t?t:void 0}addListener(e){this.listener&&this.listener.addEventListener("message",t=>{this.disallowedOrigin(t)||!fi(t.data)||e(t.data,new Te(void 0,t.source||this.target))})}disallowedOrigin(e){return e.origin&&this.allowedOrigins.length>0&&this.allowedOrigins.indexOf(new _e(e.origin).host)===-1}send(e){if(this.target)try{this.target.postMessage(e,"*")}catch(t){this.target.postMessage(JSON.parse(JSON.stringify(e)),"*")}}},lr=["onboard.triptease.io","localhost"],Pa=/^(.*)\.([^.]+)$/;function dr(r){let[,e,t]=r.match(Pa)||[];return{target:e,method:t}}function gi(r){return r&&typeof r=="object"&&"name"in r&&typeof r.name=="string"&&"message"in r&&typeof r.message=="string"&&"stack"in r&&typeof r.stack=="string"}function pr(r,e,t){return{name:r,message:e,stack:t!=null?t:""}}var Pi=q(Le());var Si=q(Bt()),Oe=q(R());var yt,Sa=new Uint8Array(16);function fr(){if(!yt&&(yt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!yt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yt(Sa)}var yi=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Oa(r){return typeof r=="string"&&yi.test(r)}var mi=Oa;var w=[];for(mt=0;mt<256;++mt)w.push((mt+256).toString(16).substr(1));var mt;function Aa(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(w[r[e+0]]+w[r[e+1]]+w[r[e+2]]+w[r[e+3]]+"-"+w[r[e+4]]+w[r[e+5]]+"-"+w[r[e+6]]+w[r[e+7]]+"-"+w[r[e+8]]+w[r[e+9]]+"-"+w[r[e+10]]+w[r[e+11]]+w[r[e+12]]+w[r[e+13]]+w[r[e+14]]+w[r[e+15]]).toLowerCase();if(!mi(t))throw TypeError("Stringified UUID is invalid");return t}var hi=Aa;function Ca(r,e,t){r=r||{};var n=r.random||(r.rng||fr)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return hi(n)}var gr=Ca;var yr=()=>p(()=>crypto.randomUUID())||gr(),mr=class{generate(e){if(typeof e!="undefined")throw new Error("UuidGenerator does not support custom lengths");return yr().replace(/-/g,"")}};var Z=class{static get last(){return C({},Z.value)}static get(e,t,n,i,o){let a={clientKey:n,clientName:i,apiKey:o,pageType:e,pagePath:t};if(!rr(Z.value)&&p(()=>{let c=C({},Z.value);return delete c.pageVisitId,I.same(c,a)}))return Z.value;let s=ke(C({},a),{pageVisitId:yr()});return Z.value=s}},z=Z;z.value={};function ht(r,e=z.last){let i=e,{pageVisitId:t}=i,n=Mr(i,["pageVisitId"]);return ke(C({},r),{context:C(C({},n),r.context||{}),pageVisitId:t})}var Oi=q(Ti());function*Ai(r){for(let e=0;e<r.frames.length;e++){let t=r.frames[e];yield t,yield*Ai(t)}}function Ha(r,e){return(0,Si.array)(Ai(r),(0,Pi.filter)(t=>p(()=>t.name)===e))}function Ci(r){return r===r.top?0:1+Ci(r.parent)}function xr(r){let[e]=r.sort((0,Oe.by)(Ci,Oe.ascending));return e}function Na(r){return r.map(e=>p(()=>{var t;return(t=e.triptease.message)==null?void 0:t.payload})).filter(Boolean)}function Fa(r){let[e]=Na(r).sort((0,Oe.by)(t=>di(t.type),Oe.ascending));return e}function vr(r){return Ha(r.top,Ke)}function ki(r,e=vr(r)){return e.length===1?H.Singleton:xr(e)===r?H.ApplicationHost:H.DataSource}function wr(r){return p(()=>{var e;return new Oi.Uri((e=r.context.page)==null?void 0:e.url).path})}function Ii(r,e){let t=Fa(r);return ht(ke(C({},e),{payload:t}),z.get(t.type,wr(e),t.clientKey,t.clientName,t.apiKey))}function _r(r){return r&&typeof r=="object"&&r.type==="triptease.onboard.request"&&typeof r.requestType=="string"&&typeof r.correlationId=="string"&&Array.isArray(r.payload)}function xt(r){return r&&typeof r=="object"&&r.type==="triptease.onboard.response"&&typeof r.correlationId=="string"}function vt(r,e){return{type:"triptease.onboard.response",correlationId:r,payload:e}}function wt(r,e){return vt(r,pr("NotFound","No handler found for "+e))}function Ri(r){return p(()=>r.payload.name==="NotFound",!1)}function Mi(r,e){return vt(r,pr(e.name,e.message,e.stack))}var Wa=T("messaging"),_t=class{constructor(){this.handlers=new Map}register(e,t){return e.forEach(n=>{if(this.hasHandlerFor(n))throw new Error(`Method name "${n}" already registered to a handler`);this.handlers.set(n,t)}),this}handle(e){return y(this,null,function*(){let t=this.handlers.get(e.requestType);return t?(Wa.debug("Matched message to handler",e,t),yield t.handle(e)):wt(e.correlationId,e.requestType)})}hasHandlerFor(e){return this.handlers.has(e)}};var Tr=T("messaging"),Pr=class{constructor(e){this.target=e}handle(e){return y(this,null,function*(){let t=this.target[e.requestType];if(!t)return Tr.debug("No method found that matches method",e.requestType,this.target),wt(e.correlationId,e.requestType);try{Tr.debug("Found method",e.requestType);let n=yield t.apply(this.target,e.payload);return vt(e.correlationId,n)}catch(n){return Tr.debug("Error trying to in invoke method",e.requestType,n),Mi(e.correlationId,n)}})}};var ji=class{constructor(e,t){this.messaging=e;this.idGenerator=t}get(e,t,n){return(...i)=>y(this,null,function*(){let o=this.idGenerator.generate(),{payload:a}=yield this.messaging.handle({type:"triptease.onboard.request",requestType:String(t),payload:i,correlationId:o});if(gi(a))throw a;return a})}};function Tt(r,e=new mr){return new Proxy({},new ji(r,e))}var qi=T("messaging"),Ae=class{constructor(e){this.messageHandler=e;this.promises=new Map;e&&e.addListener(t=>{if(xt(t)){let{correlationId:n}=t,i=this.promises.get(n);i&&(qi.debug("Sender matched response",t),i.resolve(t),this.promises.delete(n))}})}handle(e){return y(this,null,function*(){return qi.debug("Sending request",e),this.messageHandler&&this.messageHandler.send(e),new Promise((t,n)=>{this.promises.set(e.correlationId,{resolve:t,reject:n})})})}};var Pt=class{constructor(e,t,n=T("messaging")){this.listen=e;this.router=t;this.logger=n;this.rules=[];e.addListener(this.handler.bind(this)),this.addRule(_r,i=>i,i=>i),this.addRule(Ka,za,Di)}registerAlias(e,t){if(!this.router.hasHandlerFor(t))throw new Error(`Illegal alias: Method "${t}" is not registered with router`);return this.addRule(Ga(e),Ua(t),Di)}handler(e,t){return y(this,null,function*(){if(xt(e))return;this.logger.debug("listenOn received request",e);let n=this.rules.find(a=>a.predicate(e));if(!n)return;let i=n.requestConverter(e),o=yield this.router.handle(i);if(Ri(o)){this.logger.debug(`Handler not found for request "${i.requestType}", potentially for another listener`);return}e.correlationId&&e.correlationId===o.correlationId&&(this.logger.debug("listenOn sending response to sender",o),t.send(n.responseConverter(o)))})}addRule(e,t,n){return this.rules.push({predicate:e,requestConverter:t,responseConverter:n}),this}};function Ga(r){return e=>e.type===r}function Ka(r){return!_r(r)&&!!r.correlationId}function Ua(r){return e=>({type:"triptease.onboard.request",requestType:String(r),payload:[e],correlationId:e.correlationId||"fire-and-forget"})}function za(r){let{value:e,correlationId:t}=r,{method:n}=dr(r.type);return{type:"triptease.onboard.request",requestType:n,payload:[e],correlationId:t}}function Di(r){return{type:"triptease.onboard.response",correlationId:r.correlationId,value:r.payload}}var Sr=class{constructor(e){this.storage=e}get(e){let t=this.storage.getItem(e);if(t)return L.parseWithDates(t)}set(e,t){return this.storage.setItem(e,JSON.stringify(t)),this}clear(){this.storage.clear()}},Or=class{constructor(){this.data=new Map}get(e){return this.data.get(e)}set(e,t){return this.data.set(e,t)}clear(){this.data.clear()}};var Ue=class{constructor(e){this.providers=e}static create(...e){return new Ue(e)}getAnonymousIds(){return y(this,null,function*(){return U.unique(U.flatten(yield Promise.all(this.providers.map(e=>p(()=>e.getAnonymousIds(),[])))))})}setAnonymousId(e){return y(this,null,function*(){yield Promise.all(this.providers.map(t=>p(()=>t.setAnonymousId(e))))})}};var Ar="triptease-anonymous-id",St=class{constructor(e){this.storage=e}getAnonymousIds(){return y(this,null,function*(){let e=this.storage.get(Ar);return e?[e]:[]})}setAnonymousId(e){return y(this,null,function*(){let t=this.storage.get(Ar);(t&&e<t||!t)&&this.storage.set(Ar,e)})}};var Cr=class{constructor(e,t,n=Ue.create(new St(new Or),p(()=>new St(new Sr(e.localStorage)))),i=T("kernel"),o=Ge.create(e)){this.window=e;this.allowedOrigin=t;this.identityProvider=n;this.logger=i;this.starter=o}get triptease(){let e=this.window.triptease=this.window.triptease||{};return e.onboard={"kernel-host":this},pi(this,"triptease",e)}start(){return y(this,null,function*(){this.logger.debug("KernelHost starting"),this.triptease;let e=new Te(this.window,this.window.parent,[...lr,this.allowedOrigin],this.logger),t=yield this.starter.start(Va()),n=new gt(t),i=new Ae(n);this.kernel=Tt(i);let o=new Ae(e);this.bootstrap=Tt(o),new Pt(e,this.router=new _t().register(["getPageState","startApp","processConfig","getAnonymousIds","setAnonymousId"],new Pr(this)).register(["generateConfig","applicationConfig"],i)).registerAlias("triptease.config","processConfig"),new Pt(n,new _t().register(["trackError","trackMessage"],o)),e.send({type:"triptease.onboard.kernel-host-started"}),this.logger.log("KernelHost started")})}startApp(e){return y(this,null,function*(){let t=yield this.starter.start(e),n=new Ae(new gt(t));this.router.register(e.requestTypes,n)})}getAnonymousIds(){return this.identityProvider.getAnonymousIds()}setAnonymousId(e){return y(this,null,function*(){yield this.identityProvider.setAnonymousId(e)})}getPageState(){return y(this,null,function*(){return z.last})}processConfig(e){return y(this,null,function*(){let t=this.window;B(t).triptease.message=e;let n=vr(t.top),i=ki(t,n);switch(this.logger.log(`Kernel Host is in ${i} mode`),i){case H.Singleton:return this.bootstrap.processConfig(ht(e,z.get(e.payload.type,wr(e),e.payload.clientKey,e.payload.clientName,e.payload.apiKey)));case H.ApplicationHost:let o=Ii(n,e);return this.bootstrap.processConfig(o);case H.DataSource:let a=Tt(new Ae(new Te(void 0,xr(n))));return this.logger.log("Sending triptease.config message to kernel host in application host mode",e.payload),a.processConfig(e)}})}};function Va(){return{name:Ke,url:`kernel.js?${ri()}`,type:"worker",startMessage:`${Ke}-started`,enabled:!0}}(()=>y(void 0,null,function*(){yield new Cr(window,We(location.search).originHost).start()}))();})();
//]]></script></head><body></body></html>